<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/RobotMarketPlace.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> RobotMarketPlace.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>34/34</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">92.86% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>13/14</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>5/5</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>36/36</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1055×</span>
<span class="cline-any cline-yes">1054×</span>
<span class="cline-any cline-yes">1053×</span>
<span class="cline-any cline-yes">1053×</span>
<span class="cline-any cline-yes">1053×</span>
<span class="cline-any cline-yes">1053×</span>
<span class="cline-any cline-yes">1053×</span>
<span class="cline-any cline-yes">1053×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">38×</span>
<span class="cline-any cline-yes">38×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
import "./RobotFactory.sol";
&nbsp;
pragma solidity 0.8.15;
&nbsp;
/**
 * @title RobotMarketPlace contract.
 * NOTE: The contract includes functions for setting up, removing offers and buying robots.
 * @dev Contract RobotFactory contract.
 */
contract RobotMarketPlace is RobotFactory {
    struct Offer {
        address payable seller;
        uint256 price;
        uint256 tokenId;
    }
&nbsp;
    Offer[] private _offers;
&nbsp;
    // Mapping from token ID to Offer object.
    mapping(uint256 =&gt; Offer) private _tokenIdToOffer;
    // Mapping from token ID to Offer Id.
    mapping(uint256 =&gt; uint256) private _tokenIdToOfferId;
&nbsp;
    /**
     * @dev Emitted when a new transaction occurs.
     * @param TxType String type of transaction.
     * @param owner Owner address of the token.
     * @param tokenId token Id.
     */
    event MarketTransaction(string TxType, address owner, uint256 tokenId);
&nbsp;
    /**
     * @dev Function for exhibiting a token for sale.
     *
     * Requirements:
     *
     * - `_price` cannot be 0.
     * - `_tokenIdToOffer[_tokenId].price` must be 0, which mean that there is no offer for this token yet.
     *
     * @param _price The price in wei that the seller wants to receive for this token.
     * @param _tokenId Id of the token for sale.
     *
     * Emits a {MarketTransaction} event of type `Create offer`.
     */
    function setOffer(uint256 _price, uint256 _tokenId) public {
        require(_price != 0, "Price cannot be zero");
        require(_tokenIdToOffer[_tokenId].price == 0, "You can't sell twice the same offers");
        Offer memory _offer = Offer({seller: payable(msg.sender), price: _price, tokenId: _tokenId});
        _tokenIdToOffer[_tokenId] = _offer;
        _offers.push(_offer);
        uint256 index = _offers.length - 1;
        _tokenIdToOfferId[_tokenId] = index;
        emit MarketTransaction("Create offer", msg.sender, _tokenId);
    }
&nbsp;
    /**
     * @dev Function to remove from the sale a specific token.
     *
     * Requirements:
     *
     * - `ownerOf(_tokenId)` must be `msg.sender`.
     * - `offer.seller` must be `msg.sender`, which mean that only the seller can remove the offer.
     *
     * @param _tokenId Id of the token to be removed from sales.
     *
     * Emits a {MarketTransaction} event of type `Remove offer`.
     */
    function removeOffer(uint256 _tokenId) public {
        require(ownerOf(_tokenId) == msg.sender, "The user doesn't own this token");
        Offer memory offer = _tokenIdToOffer[_tokenId];
        require(offer.seller == msg.sender, "No such offer exists");
        _offers[_tokenIdToOfferId[_tokenId]] = _offers[_offers.length - 1];
        _offers.pop();
        delete _tokenIdToOffer[_tokenId];
        _approve(msg.sender, _tokenId);
        emit MarketTransaction("Remove offer", msg.sender, _tokenId);
    }
&nbsp;
    /**
     * @dev Function to buy a token available for purchase.
     *
     * Requirements:
     *
     * - `msg.value` must be `offer.price`, which means the buyer has to pay the exact price to the seller.
     *
     * @param _tokenId Id of the token to be purchased.
     *
     * Emits a {MarketTransaction} event of type `Buy`.
     */
    function buyRobot(uint256 _tokenId) public payable {
        Offer memory offer = _tokenIdToOffer[_tokenId];
        require(msg.value == offer.price, "The price is not correct");
        _offers[_tokenIdToOfferId[_tokenId]] = _offers[_offers.length - 1];
        _offers.pop();
        delete _tokenIdToOffer[_tokenId];
        _approve(msg.sender, _tokenId);
        transferFrom(offer.seller, msg.sender, _tokenId);
        offer.seller.transfer(msg.value);
        emit MarketTransaction("Buy", msg.sender, _tokenId);
    }
&nbsp;
    /**
     * @dev Returns Offer data by providing token Id.
     */
    function getOffer(uint256 _tokenId)
        public
        view
        returns (
            address payable seller,
            uint256 price,
            uint256 tokenId
        )
    {
        Offer storage offer = _tokenIdToOffer[_tokenId];
        return (offer.seller, offer.price, offer.tokenId);
    }
&nbsp;
    /**
     * @dev Returns all available tokens for sale.
     */
    function getAllTokensOnSale() public view returns (uint256[] memory listOfToken) {
        uint256 totalOffers = _offers.length;
        if (totalOffers == 0) {
            return new uint256[](0);
        } else {
            uint256[] memory resultOfToken = new uint256[](totalOffers);
            uint256 offerId;
            for (offerId = 0; offerId &lt; totalOffers; offerId++) {
                <span class="missing-if-branch" title="else path not taken" >E</span>if (_offers[offerId].price != 0) {
                    resultOfToken[offerId] = _offers[offerId].tokenId;
                }
            }
            return resultOfToken;
        }
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Aug 25 2022 21:02:11 GMT+0200 (Central European Summer Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
